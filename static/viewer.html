<!DOCTYPE html>
<html>
<body>

<script type="text/javascript">

function clearField(){
  document.forms[0].msg.value = "";
}

var xmlhttp = [];
function ajaxGet(requestedUrl, callbackFunction, channel){

	if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
		xmlhttp[channel]=new XMLHttpRequest();
	}
	else{
		// code for IE6, IE5
		xmlhttp[channel]=new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp[channel].onreadystatechange=callbackFunction;
	xmlhttp[channel].open("GET",requestedUrl,true);
	xmlhttp[channel].send();
}

function getMessages(){
	ajaxGet("./chat.txt",function(){
		if (xmlhttp[0].readyState==4 && xmlhttp[0].status==200){
			var messages = xmlhttp[0].responseText.split("<br>");
	 		var last10 = messages.slice(messages.length - 10);
			var displayMessages = last10.join('<br>');
	 		document.getElementById('ReloadThis').innerHTML=displayMessages;
	 		setTimeout('getMessages()',5000);
		}			
	},0);
}


function sendMessage(){
	var uid = document.getElementById('uid').value;
	var msg = document.getElementById('idmsg').value;
	ajaxGet('https://firstproj-mercatino73.c9.io/chat?uid=' +  uid + '&msg=' + msg,function(){
				if (xmlhttp[0].readyState==4 && xmlhttp[0].status==200){
					clearField();
					//console.log(xmlhttp[1].responseText);
				}
	},1);
}


window.onload=function(){	
	setTimeout('getMessages()',3000);
}


</script>

<div id="ReloadThis">loading chat...</div>
<hr>
<form id='myForm'>
  User Name: <input type="text" name="uid" id="uid"><br>
  Message: <input id="idmsg" type="text" name="msg">
  

  <!--input type="submit" value="Submit" -->
</form>


<button onclick="sendMessage();">send message</button>
  
</body>
</html>